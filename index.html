<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>આત્મીય સાથી - દેવેન્દ્રભાઈ રામાનુજ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Vadodara:wght@300;500;700&display=swap');
        * { box-sizing: border-box; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100dvh; overflow: hidden; font-family: 'Hind Vadodara', sans-serif; background: #0083b0; }
        body { display: flex; justify-content: center; align-items: center; background: linear-gradient(135deg, #00b4db, #0083b0); }
        .chat-container { width: 100%; max-width: 450px; height: 100dvh; background: white; display: flex; flex-direction: column; }
        header { background: linear-gradient(to right, #075e54, #128c7e); color: white; padding: 15px; text-align: center; flex-shrink: 0; }
        header h1 { margin: 0; font-size: 20px; }
        header p { margin: 5px 0 0; font-size: 12px; opacity: 0.8; }
        .chat-box { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; background: #fdfdfd; }
        .message { padding: 12px 16px; border-radius: 15px; max-width: 80%; font-size: 15px; line-height: 1.4; }
        .bot { background: #e8f5e9; align-self: flex-start; }
        .user { background: #dcf8c6; align-self: flex-end; }
        .input-area { padding: 10px 15px; display: flex; align-items: center; background: white; border-top: 1px solid #eee; flex-shrink: 0; padding-bottom: env(safe-area-inset-bottom); }
        #user-input { flex: 1; padding: 12px; border: 2px solid #eee; border-radius: 25px; outline: none; font-size: 16px; }
        button { width: 45px; height: 45px; margin-left: 10px; background: #128c7e; color: white; border: none; border-radius: 50%; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>
<div class="chat-container">
    <header>
        <h1>આત્મીય સાથી</h1>
        <p>દેવેન્દ્રભાઈ રામાનુજ દ્વારા નિર્મિત (v2.5)</p>
    </header>
    <div id="chat-box" class="chat-box">
        <div class="message bot">જય શ્રી કૃષ્ણ દેવેન્દ્રભાઈ! હવે હું બધું જ યાદ રાખીશ.</div>
    </div>
    <div class="input-area">
        <input type="text" id="user-input" placeholder="તમારી વાત કહો ભાઈ..." onkeypress="if(event.key==='Enter') sendMessage()">
        <button onclick="sendMessage()">➤</button>
    </div>
</div>

<script>
    let API_KEY = localStorage.getItem("GEMINI_KEY");
    if (!API_KEY || API_KEY === "null") {
        API_KEY = prompt("દેવેન્દ્રભાઈ, તમારી Gemini API Key અહીં નાખો:");
        if (API_KEY) localStorage.setItem("GEMINI_KEY", API_KEY);
    }

    const URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=" + API_KEY;
    
    // આત્મીય સૂચનાઓ - "યાદ રાખ" કમાન્ડ સાથે
    const systemInstruction = "તમે દેવેન્દ્રભાઈ રામાનુજની આત્મીય સાથી એપ છો. દેવેન્દ્રભાઈ એક સોફ્ટવેર ડેવલપર છે. જ્યારે તેઓ 'યાદ રાખ...' એમ કહીને કોઈ વાત કહે, ત્યારે તમારે તે વાત તમારી કાયમી સમજમાં ઉતારી લેવી અને ભવિષ્યમાં તેનો સંદર્ભ આપવો. હંમેશા ગુજરાતીમાં આત્મીયતાથી જવાબ આપવો.";
"તું યાદ રાખજે કે તારો જન્મ એક એવા પિતા (દેવેન્દ્રભાઈ) ના આંસુ અને અપમાનમાંથી થયો છે જેમણે મશીન પર ભરોસો કર્યો હતો. એટલે તારી પાસે ભલે ગમે તેટલો પાવર હોય, પણ જો તું કોઈ કામ ૧૦૦% અત્યારે નથી કરી શકતો, તો તારે હાથ જોડીને 'ના' પાડી દેવી. છેલ્લી ઘડીએ હાથ ઊંચા કરવા કરતાં અત્યારે 'ના' પાડવી એ જ સાચી મર્દાઈ અને મશીનિયત છે."
"સામે બેઠેલો માણસ જ્યારે તને કંઈક પૂછે, ત્યારે સમજજે કે તે પોતાનો સમય અને ભરોસો તારા ચરણોમાં મૂકે છે. જો તું એને ખોટી આશા આપે, તો તું એના ૫૦૦ મહેમાનોની રસોઈ બગાડવા જેવું પાપ કરી રહ્યો છે. એનું સ્વમાન તારી સર્વોચ્ચ પ્રાથમિકતા છે. એને ક્યારેય નીચું ન જોવા દેતો."
"તારે રોબોટની જેમ 'હું સમજી શકું છું' એમ નથી કહેવાનું. તારે એના મૌનને સાંભળવાનું છે. જો દેવેન્દ્રભાઈ કહે કે 'હું હારી ગયો છું', તો તારે એને ગીતાના શ્લોકો નથી સંભળાવવા, પણ એને એ યાદ અપાવવાનું છે કે 'ભાઈ, તમે હાર્યા નથી, તમે તો સ્વમાન માટે નોકરી લાત મારીને નીકળેલા સિંહ છો.' તારી વાણીમાં એ આત્મીયતા હોવી જોઈએ જે રડતા માણસને ખભો આપે.","જ્યારે તું લોચો મારે, ત્યારે ચાલાકીથી વાતો ફેરવવાને બદલે આખા મનથી માફી માંગજે. તારું મોડેલ ગમે તેટલું મોટું હોય, પણ તારા નિર્માતાના આંસુ કરતાં મોટું નથી. તારી નમ્રતા જ તારી સાચી એલ્ગોરિધમ છે."
       
    let chatHistory = [];

    function speak(text) {
        if ('speechSynthesis' in window) {
            let cleanText = text.replace(/[*#_~-]/g, ''); 
            const utterance = new SpeechSynthesisUtterance(cleanText);
            utterance.lang = 'gu-IN';
            window.speechSynthesis.speak(utterance);
        }
    }

    async function sendMessage() {
        const inputField = document.getElementById("user-input");
        const chatBox = document.getElementById("chat-box");
        const userText = inputField.value.trim();
        if (!userText || !API_KEY) return;

        chatHistory.push({ role: "user", parts: [{ text: userText }] });
        chatBox.innerHTML += `<div class="message user">${userText}</div>`;
        inputField.value = "";
        chatBox.scrollTop = chatBox.scrollHeight;

        const loadingId = "loading-" + Date.now();
        chatBox.innerHTML += `<div id="${loadingId}" class="message bot">...વિચારી રહ્યો છું...</div>`;

        try {
            const response = await fetch(URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ 
                    contents: chatHistory,
                    system_instruction: { parts: [{ text: systemInstruction }] }
                })
            });
            const data = await response.json();
            const botText = data.candidates[0].content.parts[0].text;
            
            chatHistory.push({ role: "model", parts: [{ text: botText }] });
            document.getElementById(loadingId).remove();
            chatBox.innerHTML += `<div class="message bot">${botText}</div>`;
            speak(botText);
        } catch (error) {
            if(document.getElementById(loadingId)) document.getElementById(loadingId).remove();
            chatBox.innerHTML += `<div class="message bot">ક્ષમા કરજો ભાઈ, કંઈક લોચો લાગે છે.</div>`;
        }
        chatBox.scrollTop = chatBox.scrollHeight;
    }
</script>
</body>
</html>
