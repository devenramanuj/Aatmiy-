<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ркЖркдрлНркорлАркп рк╕рк╛ркерлА - ркжрлЗрк╡рлЗркирлНркжрлНрк░ркнрк╛ркИ рк░рк╛ркорк╛ркирлБркЬ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Vadodara:wght@300;500;700&display=swap');
        * { box-sizing: border-box; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100dvh; overflow: hidden; font-family: 'Hind Vadodara', sans-serif; background: #0083b0; }
        body { display: flex; justify-content: center; align-items: center; background: linear-gradient(135deg, #00b4db, #0083b0); }
        .chat-container { width: 100%; max-width: 450px; height: 100dvh; background: white; display: flex; flex-direction: column; position: relative; }
        
        header { 
            background: linear-gradient(to right, #075e54, #128c7e); 
            color: white; padding: 15px; text-align: center; 
            flex-shrink: 0; position: relative; 
        }
        header h1 { margin: 0; font-size: 20px; }
        header p { margin: 5px 0 0; font-size: 12px; opacity: 0.8; }
        
        /* Clear Chat Button Style */
        .clear-btn {
            position: absolute; right: 15px; top: 22px;
            background: rgba(255,255,255,0.2); border: none;
            color: white; cursor: pointer; border-radius: 50%;
            width: 32px; height: 32px; font-size: 16px;
            display: flex; align-items: center; justify-content: center;
            transition: 0.3s;
        }
        .clear-btn:hover { background: rgba(255,0,0,0.4); }

        .chat-box { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; background: #fdfdfd; }
        .message { padding: 12px 16px; border-radius: 15px; max-width: 80%; font-size: 15px; line-height: 1.4; white-space: pre-wrap; }
        .bot { background: #e8f5e9; align-self: flex-start; box-shadow: 2px 2px 5px rgba(0,0,0,0.05); }
        .user { background: #dcf8c6; align-self: flex-end; box-shadow: -2px 2px 5px rgba(0,0,0,0.05); }
        
        .input-area { padding: 10px 15px; display: flex; align-items: center; background: white; border-top: 1px solid #eee; flex-shrink: 0; padding-bottom: env(safe-area-inset-bottom); }
        #user-input { flex: 1; padding: 12px; border: 2px solid #eee; border-radius: 25px; outline: none; font-size: 16px; }
        .send-btn { width: 45px; height: 45px; margin-left: 10px; background: #128c7e; color: white; border: none; border-radius: 50%; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<div class="chat-container">
    <header>
        <h1>ркЖркдрлНркорлАркп рк╕рк╛ркерлА</h1>
        <p>ркжрлЗрк╡рлЗркирлНркжрлНрк░ркнрк╛ркИ рк░рк╛ркорк╛ркирлБркЬ (v2.5)</p>
        <button class="clear-btn" onclick="clearChat()" title="ркЪрлЗркЯ рк╕рк╛ркл ркХрк░рлЛ">ЁЯЧС</button>
    </header>
    <div id="chat-box" class="chat-box"></div>
    <div class="input-area">
        <input type="text" id="user-input" placeholder="ркдркорк╛рк░рлА рк╡рк╛ркд ркХрк╣рлЛ ркнрк╛ркИ..." onkeypress="if(event.key==='Enter') sendMessage()">
        <button class="send-btn" onclick="sendMessage()">тЮд</button>
    </div>
</div>

<script>
    let API_KEY = localStorage.getItem("GEMINI_KEY");
    let chatHistory = JSON.parse(localStorage.getItem("CHAT_MEMORY")) || [];
    let tasks = JSON.parse(localStorage.getItem("DEV_TASKS")) || [];

    if (!API_KEY || API_KEY === "null") {
        API_KEY = prompt("ркжрлЗрк╡рлЗркирлНркжрлНрк░ркнрк╛ркИ, ркдркорк╛рк░рлА Gemini API Key ркЕрк╣рлАркВ ркирк╛ркЦрлЛ:");
        if (API_KEY) localStorage.setItem("GEMINI_KEY", API_KEY);
    }

    const URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=" + API_KEY;
    const systemInstruction = "ркдркорлЗ ркжрлЗрк╡рлЗркирлНркжрлНрк░ркнрк╛ркИ рк░рк╛ркорк╛ркирлБркЬркирлА ркЖркдрлНркорлАркп рк╕рк╛ркерлА ркПркк ркЫрлЛ. ркжрлЗрк╡рлЗркирлНркжрлНрк░ркнрк╛ркИ рк╕рлЛрклрлНркЯрк╡рлЗрк░ ркбрлЗрк╡рк▓рккрк░ ркЫрлЗ. ркЬрлНркпрк╛рк░рлЗ ркдрлЗркУ 'ркпрк╛ркж рк░рк╛ркЦ...' ркХрк╣рлЗ ркЕркерк╡рк╛ ркХрлЛркИ ркХрк╛ркоркирлА рк╡рк╛ркд ркХрк░рлЗ, ркдрлНркпрк╛рк░рлЗ ркдрлЗ рк╕рлНрк╡рк╛ркпркдрлНркд рк░рлАркдрлЗ ркирлЛркВркзрлА рк▓рлЗрк╡рлБркВ. рк╣ркВркорлЗрк╢рк╛ ркЧрлБркЬрк░рк╛ркдрлАркорк╛ркВ ркЖркдрлНркорлАркпркдрк╛ркерлА ркЬрк╡рк╛ркм ркЖрккрк╡рлЛ.";

    function updateTaskTracker(text) {
        const taskKeywords = ["ркХрк░рк╡рк╛ркирлБркВ ркЫрлЗ", "ркмрк╛ркХрлА ркЫрлЗ", "ркпрк╛ркж ркХрк░рк╛рк╡ркЬрлЗ", "ркЯрк╛рк╕рлНркХ"];
        if (taskKeywords.some(keyword => text.includes(keyword))) {
            tasks.push({ item: text, status: "pending", date: new Date().toLocaleString('gu-IN') });
            localStorage.setItem("DEV_TASKS", JSON.stringify(tasks));
            return "\n\n(ркорлЗркВ ркЖ ркХрк╛рко ркЯрк╛рк╕рлНркХ рк▓рк┐рк╕рлНркЯркорк╛ркВ ркирлЛркВркзрлА рк▓рлАркзрлБркВ ркЫрлЗ!)";
        }
        return "";
    }

    // ркЪрлЗркЯ рк╕рк╛ркл ркХрк░рк╡рк╛ркирлБркВ рклркВркХрлНрк╢рки
    function clearChat() {
        if (confirm("ркжрлЗрк╡рлЗркирлНркжрлНрк░ркнрк╛ркИ, рк╢рлБркВ ркмркзрлА ркЬ ркЬрлВркирлА рк╡рк╛ркдрлЛ рк╕рк╛ркл ркХрк░рк╡рлА ркЫрлЗ?")) {
            chatHistory = [];
            localStorage.removeItem("CHAT_MEMORY");
            document.getElementById("chat-box").innerHTML = `<div class="message bot">ркЪрлЗркЯ рк╕рк╛ркл ркеркИ ркЧркИ ркЫрлЗ. ркмрлЛрк▓рлЛ ркнрк╛ркИ, ркирк╡рлА рк╢рлБркВ рк╡рк╛ркд ркХрк░рк╡рлА ркЫрлЗ?</div>`;
        }
    }

    window.onload = () => {
        const chatBox = document.getElementById("chat-box");
        if (chatHistory.length === 0) {
            chatBox.innerHTML = `<div class="message bot">ркЬркп рк╢рлНрк░рлА ркХрлГрк╖рлНркг ркжрлЗрк╡рлЗркирлНркжрлНрк░ркнрк╛ркИ! рк╣рлБркВ ркдрлИркпрк╛рк░ ркЫрлБркВ.</div>`;
        } else {
            chatHistory.forEach(msg => {
                const className = msg.role === "user" ? "user" : "bot";
                chatBox.innerHTML += `<div class="message ${className}">${msg.parts[0].text}</div>`;
            });
        }
        chatBox.scrollTop = chatBox.scrollHeight;
    };
// рк╕рлНркдрлНрк░рлА рк╣рк╛рк╕рлНркпркирлЛ ркоркзрлБрк░ ркЕрк╡рк╛ркЬ рк╡ркЧрк╛ркбрк╡рк╛ ркорк╛ркЯрлЗ
function playLaugh() {
    // ркЖ ркПркХ рк╕рлНркдрлНрк░рлАркирк╛ ркоркзрлБрк░ рк╣рк╛рк╕рлНркпркирлА рк▓рк┐ркВркХ ркЫрлЗ
    const laughSound = new Audio("https://www.soundjay.com/human/laughter-6.mp3");
    laughSound.volume = 0.6; 
    laughSound.play();
}

function speak(text) {
    if ('speechSynthesis' in window) {
        // ркЬрлЛ рк▓ркЦрк╛ркгркорк╛ркВ рк╕рлНркорк┐ркд ркХрлЗ рк╣рк╛рк╕рлНркпркирк╛ ркЪрк┐ркирлНрк╣рлЛ рк╣рлЛркп
        const laughTrigger = ["ЁЯШБ", "ЁЯШВ", "рк╣рк╛..рк╣рк╛", "ркЪрлЛркХрлНркХрк╕", "ркнрк▓рлЗ ркнрк╛ркИ"];
        if (laughTrigger.some(el => text.includes(el))) {
            playLaugh();
        }

        let cleanText = text.replace(/[*#_~-]/g, ''); 
        const utterance = new SpeechSynthesisUtterance(cleanText);
        utterance.lang = 'gu-IN';
        
        // рк╕рлНркдрлНрк░рлАркирлЛ ркЕрк╡рк╛ркЬ рк╕рлЗркЯ ркХрк░рк╡рк╛ ркорк╛ркЯрлЗ (ркЬрлЛ ркмрлНрк░рк╛ркЙркЭрк░ркорк╛ркВ ркЙрккрк▓ркмрлНркз рк╣рлЛркп)
        const voices = window.speechSynthesis.getVoices();
        const femaleVoice = voices.find(voice => voice.lang === 'gu-IN' && voice.name.includes('Female'));
        if (femaleVoice) utterance.voice = femaleVoice;

        window.speechSynthesis.speak(utterance);
    }
}

  funfuntion
    ction speak(text) {
        if ('speechSynthesis' in window) {
            let cleanText = text.replace(/[*#_~-]/g, ''); 
            const utterance = new SpeechSynthesisUtterance(cleanText);
            utterance.lang = 'gu-IN';
            window.speechSynthesis.speak(utterance);
        }
    }

    async function sendMessage() {
        const inputField = document.getElementById("user-input");
        const chatBox = document.getElementById("chat-box");
        const userText = inputField.value.trim();
        if (!userText || !API_KEY) return;

        const taskNote = updateTaskTracker(userText);
        chatHistory.push({ role: "user", parts: [{ text: userText }] });
        chatBox.innerHTML += `<div class="message user">${userText}</div>`;
        inputField.value = "";
        chatBox.scrollTop = chatBox.scrollHeight;

        const loadingId = "loading-" + Date.now();
        chatBox.innerHTML += `<div id="${loadingId}" class="message bot">...рк╡рк┐ркЪрк╛рк░рлА рк░рк╣рлНркпрлЛ ркЫрлБркВ...</div>`;

        try {
            const response = await fetch(URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ contents: chatHistory, system_instruction: { parts: [{ text: systemInstruction }] } })
            });
            const data = await response.json();
            let botText = data.candidates[0].content.parts[0].text + taskNote;

            chatHistory.push({ role: "model", parts: [{ text: botText }] });
            localStorage.setItem("CHAT_MEMORY", JSON.stringify(chatHistory));

            document.getElementById(loadingId).remove();
            chatBox.innerHTML += `<div class="message bot">${botText}</div>`;
            speak(botText);
        } catch (error) {
            if(document.getElementById(loadingId)) document.getElementById(loadingId).remove();
            chatBox.innerHTML += `<div class="message bot">ркХрлНрк╖ркорк╛ ркХрк░ркЬрлЛ ркнрк╛ркИ, ркХркВркИркХ рк▓рлЛркЪрлЛ рк▓рк╛ркЧрлЗ ркЫрлЗ.</div>`;
        }
        chatBox.scrollTop = chatBox.scrollHeight;
    }
</script>
</body>
</html>
