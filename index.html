<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ркЖркдрлНркорлАркп рк╕рк╛ркерлА - ркжрлЗрк╡рлЗркирлНркжрлНрк░ркнрк╛ркИ рк░рк╛ркорк╛ркирлБркЬ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Vadodara:wght@300;500;700&display=swap');
        * { box-sizing: border-box; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100dvh; overflow: hidden; font-family: 'Hind Vadodara', sans-serif; background: #0083b0; }
        body { display: flex; justify-content: center; align-items: center; background: linear-gradient(135deg, #00b4db, #0083b0); }
        .chat-container { width: 100%; max-width: 450px; height: 100dvh; background: white; display: flex; flex-direction: column; position: relative; }
        header { background: linear-gradient(to right, #075e54, #128c7e); color: white; padding: 15px; text-align: center; flex-shrink: 0; }
        header h1 { margin: 0; font-size: 20px; }
        header p { margin: 5px 0 0; font-size: 12px; opacity: 0.8; }
        .chat-box { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; background: #fdfdfd; }
        .message { padding: 12px 16px; border-radius: 15px; max-width: 80%; font-size: 15px; line-height: 1.4; white-space: pre-wrap; }
        .bot { background: #e8f5e9; align-self: flex-start; box-shadow: 2px 2px 5px rgba(0,0,0,0.05); }
        .user { background: #dcf8c6; align-self: flex-end; box-shadow: -2px 2px 5px rgba(0,0,0,0.05); }
        .input-area { padding: 10px 15px; display: flex; align-items: center; background: white; border-top: 1px solid #eee; flex-shrink: 0; padding-bottom: env(safe-area-inset-bottom); }
        #user-input { flex: 1; padding: 12px; border: 2px solid #eee; border-radius: 25px; outline: none; font-size: 16px; }
        button { width: 45px; height: 45px; margin-left: 10px; background: #128c7e; color: white; border: none; border-radius: 50%; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; transition: 0.3s; }
        button:hover { transform: scale(1.1); }
    </style>
</head>
<body>

<div class="chat-container">
    <header>
        <h1>ркЖркдрлНркорлАркп рк╕рк╛ркерлА</h1>
        <p>ркжрлЗрк╡рлЗркирлНркжрлНрк░ркнрк╛ркИ рк░рк╛ркорк╛ркирлБркЬ - Autonomous Assistant (v2.5)</p>
    </header>
    <div id="chat-box" class="chat-box">
        </div>
    <div class="input-area">
        <input type="text" id="user-input" placeholder="ркдркорк╛рк░рлА рк╡рк╛ркд ркХрк╣рлЛ ркнрк╛ркИ..." onkeypress="if(event.key==='Enter') sendMessage()">
        <button onclick="sendMessage()">тЮд</button>
    </div>
</div>

<script>
    // рлз. ркбрлЗркЯрк╛ рк▓рлЛркбрк┐ркВркЧ
    let API_KEY = localStorage.getItem("GEMINI_KEY");
    let chatHistory = JSON.parse(localStorage.getItem("CHAT_MEMORY")) || [];
    let tasks = JSON.parse(localStorage.getItem("DEV_TASKS")) || [];

    if (!API_KEY || API_KEY === "null") {
        API_KEY = prompt("ркжрлЗрк╡рлЗркирлНркжрлНрк░ркнрк╛ркИ, ркдркорк╛рк░рлА Gemini API Key ркЕрк╣рлАркВ ркирк╛ркЦрлЛ:");
        if (API_KEY) localStorage.setItem("GEMINI_KEY", API_KEY);
    }

    const URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=" + API_KEY;
    
    // ркЖркдрлНркорлАркп рк╕рлВркЪркирк╛ркУ - Autonomous рк▓рлЛркЬрк┐ркХ рк╕рк╛ркерлЗ
    const systemInstruction = "ркдркорлЗ ркжрлЗрк╡рлЗркирлНркжрлНрк░ркнрк╛ркИ рк░рк╛ркорк╛ркирлБркЬркирлА ркЖркдрлНркорлАркп рк╕рк╛ркерлА ркПркк ркЫрлЛ. ркжрлЗрк╡рлЗркирлНркжрлНрк░ркнрк╛ркИ рк╕рлЛрклрлНркЯрк╡рлЗрк░ ркбрлЗрк╡рк▓рккрк░ ркЫрлЗ. ркЬрлНркпрк╛рк░рлЗ ркдрлЗркУ 'ркпрк╛ркж рк░рк╛ркЦ...' ркХрк╣рлЗ ркЕркерк╡рк╛ ркХрлЛркИ ркХрк╛ркоркирлА рк╡рк╛ркд ркХрк░рлЗ, ркдрлНркпрк╛рк░рлЗ ркдрлЗ рк╡рк╛ркд рк╕рлНрк╡рк╛ркпркдрлНркд рк░рлАркдрлЗ ркирлЛркВркзрлА рк▓рлЗрк╡рлА. рк╣ркВркорлЗрк╢рк╛ ркЧрлБркЬрк░рк╛ркдрлАркорк╛ркВ ркЖркдрлНркорлАркпркдрк╛ркерлА ркЬрк╡рк╛ркм ркЖрккрк╡рлЛ. ркХрлНркпрк╛рк░рлЗркп ркЦрлЛркЯрк╛ рк╡рк╛ркпркжрк╛ рки ркХрк░рк╡рк╛.";

    // рли. ркЯрк╛рк╕рлНркХ ркЯрлНрк░рлЗркХрк░ рк▓рлЛркЬрк┐ркХ
    function updateTaskTracker(text) {
        const taskKeywords = ["ркХрк░рк╡рк╛ркирлБркВ ркЫрлЗ", "ркмрк╛ркХрлА ркЫрлЗ", "ркпрк╛ркж ркХрк░рк╛рк╡ркЬрлЗ", "ркЯрк╛рк╕рлНркХ", "рк╢рлАркЦрк╡рк╛ркирлБркВ ркЫрлЗ"];
        if (taskKeywords.some(keyword => text.includes(keyword))) {
            tasks.push({ item: text, status: "pending", date: new Date().toLocaleString('gu-IN') });
            localStorage.setItem("DEV_TASKS", JSON.stringify(tasks));
            return "\n\n(ркирлЛркВркз: ркжрлЗрк╡рлЗркирлНркжрлНрк░ркнрк╛ркИ, ркорлЗркВ ркЖ ркХрк╛рко ркдркорк╛рк░рк╛ ркЯрк╛рк╕рлНркХ рк▓рк┐рк╕рлНркЯркорк╛ркВ ркирлЛркВркзрлА рк▓рлАркзрлБркВ ркЫрлЗ! ЁЯШБ)";
        }
        return "";
    }

    // рлй. рккрлЗркЬ рк▓рлЛркб ркеркдрк╛ ркЬрлВркирлА рк╡рк╛ркдрлЛ ркмркдрк╛рк╡рк╡рлА
    window.onload = () => {
        const chatBox = document.getElementById("chat-box");
        if (chatHistory.length === 0) {
            chatBox.innerHTML = `<div class="message bot">ркЬркп рк╢рлНрк░рлА ркХрлГрк╖рлНркг ркжрлЗрк╡рлЗркирлНркжрлНрк░ркнрк╛ркИ! рк╣рлБркВ ркдрлИркпрк╛рк░ ркЫрлБркВ. ркЖрккркгрлЗ 'Vidushi' ркХрлЗ ркмрлАркЬрк╛ ркХрлЛркИ рккрлНрк░рлЛркЬрлЗркХрлНркЯ рккрк░ ркХрк╛рко рк╢рк░рлВ ркХрк░рлАркП?</div>`;
        } else {
            chatHistory.forEach(msg => {
                const className = msg.role === "user" ? "user" : "bot";
                chatBox.innerHTML += `<div class="message ${className}">${msg.parts[0].text}</div>`;
            });
        }
        chatBox.scrollTop = chatBox.scrollHeight;
    };

    function speak(text) {
        if ('speechSynthesis' in window) {
            let cleanText = text.replace(/[*#_~-]/g, ''); 
            const utterance = new SpeechSynthesisUtterance(cleanText);
            utterance.lang = 'gu-IN';
            window.speechSynthesis.speak(utterance);
        }
    }

    // рлк. ркорлЗрк╕рлЗркЬ ркорлЛркХрк▓рк╡рк╛ркирлБркВ рклркВркХрлНрк╢рки
    async function sendMessage() {
        const inputField = document.getElementById("user-input");
        const chatBox = document.getElementById("chat-box");
        const userText = inputField.value.trim();
        
        if (!userText || !API_KEY) return;

        // Autonomous ркЯрк╛рк╕рлНркХ ркЪрлЗркХ
        const taskNote = updateTaskTracker(userText);

        chatHistory.push({ role: "user", parts: [{ text: userText }] });
        chatBox.innerHTML += `<div class="message user">${userText}</div>`;
        inputField.value = "";
        chatBox.scrollTop = chatBox.scrollHeight;

        const loadingId = "loading-" + Date.now();
        chatBox.innerHTML += `<div id="${loadingId}" class="message bot">...рк╡рк┐ркЪрк╛рк░рлА рк░рк╣рлНркпрлЛ ркЫрлБркВ ркнрк╛ркИ...</div>`;

        try {
            const response = await fetch(URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ 
                    contents: chatHistory,
                    system_instruction: { parts: [{ text: systemInstruction }] }
                })
            });
            const data = await response.json();
            let botText = data.candidates[0].content.parts[0].text;
            
            // ркЬрлЛ ркЯрк╛рк╕рлНркХ ркПркб ркеркпрлЛ рк╣рлЛркп ркдрлЛ ркмрлЛркЯркирк╛ ркЬрк╡рк╛ркмркорк╛ркВ ркЙркорлЗрк░рлЛ
            botText += taskNote;

            chatHistory.push({ role: "model", parts: [{ text: botText }] });
            localStorage.setItem("CHAT_MEMORY", JSON.stringify(chatHistory));

            document.getElementById(loadingId).remove();
            chatBox.innerHTML += `<div class="message bot">${botText}</div>`;
            speak(botText);
        } catch (error) {
            if(document.getElementById(loadingId)) document.getElementById(loadingId).remove();
            chatBox.innerHTML += `<div class="message bot">ркХрлНрк╖ркорк╛ ркХрк░ркЬрлЛ ркнрк╛ркИ, ркЕркдрлНркпрк╛рк░рлЗ ркХрлЛркИ ркЯрлЗркХркирк┐ркХрк▓ рк╕ркорк╕рлНркпрк╛ ркЫрлЗ.</div>`;
        }
        chatBox.scrollTop = chatBox.scrollHeight;
    }
</script>

</body>
</html>
