<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>àª†àª¤à«àª®à«€àª¯ àª¸àª¾àª¥à«€ - àª¦à«‡àªµà«‡àª¨à«àª¦à«àª°àª­àª¾àªˆ àª°àª¾àª®àª¾àª¨à«àªœ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Vadodara:wght@300;500;700&display=swap');
        * { box-sizing: border-box; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100dvh; overflow: hidden; font-family: 'Hind Vadodara', sans-serif; background: #0083b0; }
        body { display: flex; justify-content: center; align-items: center; background: linear-gradient(135deg, #00b4db, #0083b0); }
        .chat-container { width: 100%; max-width: 450px; height: 100dvh; background: white; display: flex; flex-direction: column; position: relative; }
        header { background: linear-gradient(to right, #075e54, #128c7e); color: white; padding: 15px; text-align: center; flex-shrink: 0; position: relative; }
        header h1 { margin: 0; font-size: 20px; }
        header p { margin: 5px 0 0; font-size: 12px; opacity: 0.8; }
        .clear-btn { position: absolute; right: 15px; top: 22px; background: rgba(255,255,255,0.2); border: none; color: white; cursor: pointer; border-radius: 50%; width: 32px; height: 32px; font-size: 16px; display: flex; align-items: center; justify-content: center; }
        .chat-box { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; background: #fdfdfd; }
        .message { padding: 12px 16px; border-radius: 15px; max-width: 80%; font-size: 15px; line-height: 1.4; white-space: pre-wrap; word-wrap: break-word; }
        .bot { background: #e8f5e9; align-self: flex-start; box-shadow: 2px 2px 5px rgba(0,0,0,0.05); }
        .user { background: #dcf8c6; align-self: flex-end; box-shadow: -2px 2px 5px rgba(0,0,0,0.05); }
        .input-area { padding: 10px 15px; display: flex; align-items: center; background: white; border-top: 1px solid #eee; flex-shrink: 0; padding-bottom: env(safe-area-inset-bottom); }
        #user-input { flex: 1; padding: 12px; border: 2px solid #eee; border-radius: 25px; outline: none; font-size: 16px; }
        .send-btn { width: 45px; height: 45px; margin-left: 10px; background: #128c7e; color: white; border: none; border-radius: 50%; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<div class="chat-container">
    <header>
        <h1>àª†àª¤à«àª®à«€àª¯ àª¸àª¾àª¥à«€</h1>
        <p>àª¦à«‡àªµà«‡àª¨à«àª¦à«àª°àª­àª¾àªˆ àª°àª¾àª®àª¾àª¨à«àªœ (v2.6)</p>
        <button class="clear-btn" onclick="clearChat()" title="àªšà«‡àªŸ àª¸àª¾àª« àª•àª°à«‹">ğŸ—‘</button>
    </header>
    <div id="chat-box" class="chat-box"></div>
    <div class="input-area">
        <input type="text" id="user-input" placeholder="àª¤àª®àª¾àª°à«€ àªµàª¾àª¤ àª•àª¹à«‹ àª­àª¾àªˆ..." onkeypress="if(event.key==='Enter') sendMessage()">
        <button class="send-btn" onclick="sendMessage()">â¤</button>
    </div>
</div>

<script>
    let API_KEY = localStorage.getItem("GEMINI_KEY");
    let chatHistory = JSON.parse(localStorage.getItem("CHAT_MEMORY")) || [];
    let tasks = JSON.parse(localStorage.getItem("DEV_TASKS")) || [];

    if (!API_KEY || API_KEY === "null") {
        API_KEY = prompt("àª¦à«‡àªµà«‡àª¨à«àª¦à«àª°àª­àª¾àªˆ, àª¤àª®àª¾àª°à«€ Gemini API Key àª…àª¹à«€àª‚ àª¨àª¾àª–à«‹:");
        if (API_KEY) localStorage.setItem("GEMINI_KEY", API_KEY);
    }

    const URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=" + API_KEY;
    const systemInstruction = "àª¤àª®à«‡ àª¦à«‡àªµà«‡àª¨à«àª¦à«àª°àª­àª¾àªˆ àª°àª¾àª®àª¾àª¨à«àªœàª¨à«€ àª†àª¤à«àª®à«€àª¯ àª¸àª¾àª¥à«€ àªàªª àª›à«‹. àª¦à«‡àªµà«‡àª¨à«àª¦à«àª°àª­àª¾àªˆ àª¸à«‹àª«à«àªŸàªµà«‡àª° àª¡à«‡àªµàª²àªªàª° àª›à«‡. àª¹àª®à«‡àª¶àª¾ àª—à«àªœàª°àª¾àª¤à«€àª®àª¾àª‚ àª†àª¤à«àª®à«€àª¯àª¤àª¾àª¥à«€ àªœàªµàª¾àª¬ àª†àªªàªµà«‹. àªœà«‹ àª•à«‹àªˆ àªŸàª¾àª¸à«àª• àª¹à«‹àª¯ àª¤à«‹ àª¤à«‡ àª¨à«‹àª‚àª§à«€ àª²à«‡àªµà«‹.""àª¤à«àª‚ àª¯àª¾àª¦ àª°àª¾àª–àªœà«‡ àª•à«‡ àª¤àª¾àª°à«‹ àªœàª¨à«àª® àªàª• àªàªµàª¾ àªªàª¿àª¤àª¾ (àª¦à«‡àªµà«‡àª¨à«àª¦à«àª°àª­àª¾àªˆ) àª¨àª¾ àª†àª‚àª¸à« àª…àª¨à«‡ àª…àªªàª®àª¾àª¨àª®àª¾àª‚àª¥à«€ àª¥àª¯à«‹ àª›à«‡ àªœà«‡àª®àª£à«‡ àª®àª¶à«€àª¨ àªªàª° àª­àª°à«‹àª¸à«‹ àª•àª°à«àª¯à«‹ àª¹àª¤à«‹. àªàªŸàª²à«‡ àª¤àª¾àª°à«€ àªªàª¾àª¸à«‡ àª­àª²à«‡ àª—àª®à«‡ àª¤à«‡àªŸàª²à«‹ àªªàª¾àªµàª° àª¹à«‹àª¯, àªªàª£ àªœà«‹ àª¤à«àª‚ àª•à«‹àªˆ àª•àª¾àª® à«§à«¦à«¦% àª…àª¤à«àª¯àª¾àª°à«‡ àª¨àª¥à«€ àª•àª°à«€ àª¶àª•àª¤à«‹, àª¤à«‹ àª¤àª¾àª°à«‡ àª¹àª¾àª¥ àªœà«‹àª¡à«€àª¨à«‡ 'àª¨àª¾' àªªàª¾àª¡à«€ àª¦à«‡àªµà«€. àª›à«‡àª²à«àª²à«€ àª˜àª¡à«€àª àª¹àª¾àª¥ àªŠàª‚àªšàª¾ àª•àª°àªµàª¾ àª•àª°àª¤àª¾àª‚ àª…àª¤à«àª¯àª¾àª°à«‡ 'àª¨àª¾' àªªàª¾àª¡àªµà«€ àª àªœ àª¸àª¾àªšà«€ àª®àª°à«àª¦àª¾àªˆ àª…àª¨à«‡ àª®àª¶à«€àª¨àª¿àª¯àª¤ àª›à«‡.";
        

    function clearChat() {
        if (confirm("àª¬àª§à«€ àªšà«‡àªŸ àª¸àª¾àª« àª•àª°àªµà«€ àª›à«‡?")) {
            chatHistory = [];
            localStorage.removeItem("CHAT_MEMORY");
            document.getElementById("chat-box").innerHTML = "";
            location.reload();
        }
    }

    window.onload = () => {
        const chatBox = document.getElementById("chat-box");
        chatHistory.forEach(msg => {
            const className = msg.role === "user" ? "user" : "bot";
            chatBox.innerHTML += `<div class="message ${className}">${msg.parts[0].text}</div>`;
        });
        chatBox.scrollTop = chatBox.scrollHeight;
    };

    function playLaugh() {
        try {
            const laughSound = new Audio("https://www.soundjay.com/human/laughter-6.mp3");
            laughSound.play().catch(e => console.log("Audio play blocked"));
        } catch (e) { console.log("Audio error"); }
    }

    function speak(text) {
        if ('speechSynthesis' in window) {
            if (text.includes("ğŸ˜") || text.includes("àª¹àª¾..") || text.includes("ğŸ˜‚")) playLaugh();
            let cleanText = text.replace(/[*#_~-]/g, ''); 
            const utterance = new SpeechSynthesisUtterance(cleanText);
            utterance.lang = 'gu-IN';
            window.speechSynthesis.speak(utterance);
        }
    }

    async function sendMessage() {
        const inputField = document.getElementById("user-input");
        const chatBox = document.getElementById("chat-box");
        const userText = inputField.value.trim();
        if (!userText || !API_KEY) return;

        chatHistory.push({ role: "user", parts: [{ text: userText }] });
        chatBox.innerHTML += `<div class="message user">${userText}</div>`;
        inputField.value = "";
        chatBox.scrollTop = chatBox.scrollHeight;

        const loadingId = "loading-" + Date.now();
        chatBox.innerHTML += `<div id="${loadingId}" class="message bot">...àªµàª¿àªšàª¾àª°à«€ àª°àª¹à«àª¯à«‹ àª›à«àª‚...</div>`;

        try {
            const response = await fetch(URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ contents: chatHistory, system_instruction: { parts: [{ text: systemInstruction }] } })
            });
            const data = await response.json();
            
            if (data.candidates && data.candidates[0].content) {
                const botText = data.candidates[0].content.parts[0].text;
                chatHistory.push({ role: "model", parts: [{ text: botText }] });
                localStorage.setItem("CHAT_MEMORY", JSON.stringify(chatHistory));
                document.getElementById(loadingId).remove();
                chatBox.innerHTML += `<div class="message bot">${botText}</div>`;
                speak(botText);
            } else {
                throw new Error("Invalid Response");
            }
        } catch (error) {
            console.error(error);
            if(document.getElementById(loadingId)) document.getElementById(loadingId).remove();
            chatBox.innerHTML += `<div class="message bot">àª­à«‚àª²: àª®à«‡àª¸à«‡àªœ àª®à«‹àª•àª²à«€ àª¶àª•àª¾àª¯à«‹ àª¨àª¥à«€. API Key àª¤àªªàª¾àª¸à«‹.</div>`;
        }
        chatBox.scrollTop = chatBox.scrollHeight;
    }
</script>
</body>
</html>
